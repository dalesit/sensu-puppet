{
  "rabbitmq": [
    <%- scope.lookupvar('sensu::rabbitmq_hosts').each do |host| %>
      {
      <%- if host.has_key?('ssl') %>
        <%- if host['ssl'].has_key?('private_key_file') && host['ssl'].has_key?('cert_chain_file') -%>
        "ssl": {
          "private_key_file": "<%= host['ssl']['private_key_file'] %>",
          "cert_chain_file": "<%= host['ssl']['cert_chain_file'] %>"
        },
        <%- elsif scope.lookupvar('sensu::rabbitmq_ssl_private_key') && scope.lookupvar('sensu::rabbitmq_ssl_cert_chain') -%>
        "ssl": {
          "private_key_file": "<%= scope.lookupvar('sensu::rabbitmq_ssl_private_key') %>",
          "cert_chain_file": "<%= scope.lookupvar('sensu::rabbitmq_ssl_cert_chain') %>"
        },
        <%- end -%>
      <%- end -%>

      <%- if host.has_key?('port') -%>
        "port": <%= host['port'] %>,
      <%- elsif scope.lookupvar('sensu::rabbitmq_port') -%>
        "port": "<%= scope.lookupvar('sensu::rabbitmq_port') %>",
      <%- end -%>

      <%- if host.has_key?('host') -%>
        "host": <%= host['host'] -%>,
      <%- elsif scope.lookupvar('sensu::rabbitmq_host') -%>
        "host": "<%= scope.lookupvar('sensu::rabbitmq_host') %>",
      <%- end -%>

      <%- if host.has_key?('password') %>
        "password": <%= host['password'] %>,
      <%- elsif scope.lookupvar('sensu::rabbitmq_password') %>
        "password": "<%= scope.lookupvar('sensu::rabbitmq_password') %>",
      <%- end -%>

      <%- if host.has_key?('vhost') %>
        "vhost": <%= host['vhost'] %>,
      <%- elsif scope.lookupvar('sensu::rabbitmq_vhost') %>
        "vhost": "<%= scope.lookupvar('sensu::rabbitmq_vhost') %>",
      <%- end -%>

      <%- if host.has_key?('reconnect_on_error') %>
        "reconnect_on_error": true
      <%- elsif scope.lookupvar('sensu::rabbitmq_reconnect_on_error') %>
        "reconnect_on_error": "<%= scope.lookupvar('sensu::rabbitmq_reconnect_on_error') %>",
      <%- else %>
        "reconnect_on_error": false
      <%- end %>
      <%- if scope.lookupvar('sensu::rabbitmq_hosts')[-1] != host %>
      },
      <%- else %>
      }
      <%- end %>
    <%- end %>
  ]
}
